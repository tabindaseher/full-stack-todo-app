# Authentication Specification

## Authentication System
- **Primary System**: Better Auth integration
- **Token Type**: JWT (JSON Web Tokens)
- **Architecture**: Stateless, token-based authentication
- **Secret Management**: Loaded from environment variables

## JWT Configuration
- **Secret Key**: Stored in `BETTER_AUTH_SECRET` environment variable
- **Algorithm**: HS256 (HMAC SHA-256)
- **Token Claims**: Contains user identity information from Better Auth
- **Expiration**: Managed by Better Auth system

## Token Validation
- **Validation Method**: Backend validates JWT tokens on every protected endpoint
- **Validation Location**: JWT validation middleware processes all incoming requests
- **Verification**: Signature verification using the same secret key as Better Auth
- **User Identity**: Extract user ID from validated token claims

## Environment Variables
- `BETTER_AUTH_SECRET`: Secret key for JWT signing/verification (required)
- `BETTER_AUTH_URL`: URL of the Better Auth service for integration (required)
- **Storage**: All secrets must be loaded from environment variables only

## Authentication Flow
1. Frontend receives JWT token from Better Auth upon successful login
2. Frontend includes JWT token in Authorization header for all API requests
3. Backend middleware intercepts requests and validates JWT token
4. Validation confirms token signature and extracts user identity
5. Request proceeds if token is valid, otherwise returns 401 Unauthorized

## Authorization Enforcement
- **User Isolation**: Users can only access/modify their own data
- **Ownership Checks**: All data operations verify user_id matches authenticated user
- **Permission Model**: Simple ownership-based model (no role-based access)

## Security Measures
- **Token Storage**: Tokens treated as sensitive data, not logged or exposed
- **Transmission Security**: Tokens only transmitted over HTTPS
- **Replay Protection**: JWT expiration prevents indefinite token reuse
- **Secret Rotation**: Support for rotating secrets without downtime

## Integration Points
- **Frontend Compatibility**: Designed to work with existing Next.js frontend
- **Better Auth Integration**: Leverages Better Auth's token generation and validation
- **Seamless Handoff**: Tokens generated by Better Auth are consumed by backend